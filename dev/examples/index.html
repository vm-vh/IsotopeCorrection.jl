<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · NaturalIsotopeCorrection.jl</title><meta name="title" content="Examples · NaturalIsotopeCorrection.jl"/><meta property="og:title" content="Examples · NaturalIsotopeCorrection.jl"/><meta property="twitter:title" content="Examples · NaturalIsotopeCorrection.jl"/><meta name="description" content="Documentation for NaturalIsotopeCorrection.jl."/><meta property="og:description" content="Documentation for NaturalIsotopeCorrection.jl."/><meta property="twitter:description" content="Documentation for NaturalIsotopeCorrection.jl."/><meta property="og:url" content="https://vm-vh.github.io/NaturalIsotopeCorrection.jl/dev/examples/"/><meta property="twitter:url" content="https://vm-vh.github.io/NaturalIsotopeCorrection.jl/dev/examples/"/><link rel="canonical" href="https://vm-vh.github.io/NaturalIsotopeCorrection.jl/dev/examples/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../background/">NaturalIsotopeCorrection.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../background/">Background</a></li><li><a class="tocitem" href="../">Reference</a></li><li class="is-active"><a class="tocitem" href>Examples</a><ul class="internal"><li><a class="tocitem" href="#Example-1:-Basic-Usage"><span>Example 1: Basic Usage</span></a></li><li><a class="tocitem" href="#Example-2:-Usage-with-a-DataFrame"><span>Example 2: Usage with a DataFrame</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/vm-vh/NaturalIsotopeCorrection.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/vm-vh/NaturalIsotopeCorrection.jl/blob/main/docs/src/examples.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="Example-1:-Basic-Usage"><a class="docs-heading-anchor" href="#Example-1:-Basic-Usage">Example 1: Basic Usage</a><a id="Example-1:-Basic-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Basic-Usage" title="Permalink"></a></h2><p>In the first example we will correct a measured response vector of the M-57 alanine fragment. First the chemical formula of the fragment and the response vector have to be defined, after which the uncorrected mass isotopomer distribution (MID) can be calculated.</p><div class="admonition is-info"><header class="admonition-header">Labeled Carbon</header><div class="admonition-body"><p>The number after &quot;LabC&quot; in the chemical formula represents the number of possibly labeled carbon atoms in the fragment while the number behind &quot;C&quot; is the total number of carbon atoms, both from the alanine and from any derivative groups.</p></div></div><pre><code class="language-julia hljs">using NaturalIsotopeCorrection

ala_m57 = &quot;C11H26N1O2Si2LabC3&quot;
response_vec = [2500000, 2000000, 2500000, 800000]
MID = response_vec ./ sum(response_vec)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
 0.32051282051282054
 0.2564102564102564
 0.32051282051282054
 0.10256410256410256</code></pre><p>The function <code>isotope_correction()</code>` can be directly used on a single measurement vector. Here we are assuming that the tracer used for this experiment had an 80% purity.</p><pre><code class="language-julia hljs">corr_resp, corr_MID, mean_enrich, residuum = isotope_correction(response_vec,
                                                                ala_m57;
                                                                tracer_purity = 0.8)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">([3.7494356377578774e6, 1.582246275076472e6, 3.110758584864337e6, 392021.5450371306], [0.42441018135800024, 0.17909933478943207, 0.3521163563572243, 0.04437412749534335], 0.5041136074974777, [7.161631798132872e-13, 8.285188904175392e-13, -1.0657673462843284e-12, 6.363440591555375e-13])</code></pre><p><code>corr_resp</code>` is the corrected measurement vector,</p><pre><code class="language-julia hljs">corr_resp</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
      3.7494356377578774e6
      1.582246275076472e6
      3.110758584864337e6
 392021.5450371306</code></pre><p><code>corr_MID</code> is the MID of the corrected measurement vector,</p><pre><code class="language-julia hljs">corr_MID</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
 0.42441018135800024
 0.17909933478943207
 0.3521163563572243
 0.04437412749534335</code></pre><p><code>mean_enrich</code> is the mean enrichment of the corrected measurement vector,</p><pre><code class="language-julia hljs">mean_enrich</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.5041136074974777</code></pre><p>and <code>residuum</code> is the residals of the optimization.</p><pre><code class="language-julia hljs">residuum</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
  7.161631798132872e-13
  8.285188904175392e-13
 -1.0657673462843284e-12
  6.363440591555375e-13</code></pre><p>The optimization can also be turned off, using the <code>optimization = false</code> keyword argument, though this isn&#39;t recommended as the optimization prevents negative values in the corrected response.</p><p>To visualize the effects of <code>isotope_correction()</code>, the MID can be plotted before and after correction.</p><pre><code class="language-julia hljs">using ColorSchemes, CairoMakie

colors = colorschemes[:bamako][1:64:end];
group_color = [PolyElement(color = color, strokecolor = :transparent)
    for color in colors]
labels = [&quot;m+0&quot;, &quot;m+1&quot;, &quot;m+2&quot;, &quot;m+3&quot;]
Mplus = [0, 1, 2, 3]

fig = Figure();
ax = Axis(fig[1,1],
    xticks = (1:2, [&quot;uncorrected&quot;, &quot;corrected&quot;]),
    title = &quot;Alanine (M-57) MID&quot;)
barplot!(ax, repeat([1, 2], inner = length(corr_MID)),
    cat(MID, corr_MID, dims = 1),
    stack = repeat(Mplus, 2),
    colormap = colors,
    color = repeat(Mplus .+ 1, 2))

Legend(fig[1,2], group_color, labels, framevisible = false)
fig</code></pre><img src="572eae2f.png" alt="Example block output"/><h2 id="Example-2:-Usage-with-a-DataFrame"><a class="docs-heading-anchor" href="#Example-2:-Usage-with-a-DataFrame">Example 2: Usage with a DataFrame</a><a id="Example-2:-Usage-with-a-DataFrame-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Usage-with-a-DataFrame" title="Permalink"></a></h2><p>For this example we will make a very simple DataFrame with 2 samples for each of which 2 methionine fragments were measured, specifically M-159 and M-57. We need the chemical formulas of both fragments, as shown in the code below, as well as measured response vectors. For this example the measured response for sample 1 is all possible m+ being recorded with equal frequency while the measured response for sample 2 is simply a random vector.</p><div class="admonition is-info"><header class="admonition-header">Labeled Carbon</header><div class="admonition-body"><p>The number after &quot;LabC&quot; in the chemical formula represents the number of possibly labeled carbon atoms in the fragment while the number behind &quot;C&quot; is the total number of carbon atoms, both from the methionine and from any derivative groups.</p></div></div><pre><code class="language-julia hljs">using NaturalIsotopeCorrection
using DataFrames, DataFramesMeta

df = DataFrame(
    Sample = repeat([1, 2], inner = 11),
    AminoAcidFragment = repeat(cat(repeat([&quot;Met_(M-159)&quot;], 5), repeat([&quot;Met_(M-57)&quot;], 6), dims = 1), 2),
    Molecule = repeat(cat(repeat([&quot;C10H24N1S1Si1LabC4&quot;], 5), repeat([&quot;C13H30N1O2S1Si2LabC5&quot;], 6), dims = 1), 2),
    MZ0 = repeat(cat(repeat([218], 5), repeat([320], 6), dims = 1), 2),
    Mplus = repeat(cat(repeat(0:4, 1), repeat(0:5, 1), dims = 1), 2),
    Response = cat(repeat([1e6/5], 5), repeat([1e6/6], 6), rand(0:1e6, 11), dims = 1))

# Of course normally the first step would be to read in (and prepare) real data,
# using CSV.jl or XLSX.jl, for example.

# using CSV
# df = CSV.read(&quot;DATA.csv&quot;, DataFrame)</code></pre><div><div style = "float: left;"><span>22×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Sample</th><th style = "text-align: left;">AminoAcidFragment</th><th style = "text-align: left;">Molecule</th><th style = "text-align: left;">MZ0</th><th style = "text-align: left;">Mplus</th><th style = "text-align: left;">Response</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">0</td><td style = "text-align: right;">200000.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">1</td><td style = "text-align: right;">200000.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">2</td><td style = "text-align: right;">200000.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">3</td><td style = "text-align: right;">200000.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">4</td><td style = "text-align: right;">200000.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">4</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">5</td><td style = "text-align: right;">1.66667e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">0</td><td style = "text-align: right;">141984.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4859.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">2</td><td style = "text-align: right;">418641.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">3</td><td style = "text-align: right;">811925.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">4</td><td style = "text-align: right;">575490.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">0</td><td style = "text-align: right;">184399.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">1</td><td style = "text-align: right;">453077.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">2</td><td style = "text-align: right;">478667.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">3</td><td style = "text-align: right;">161608.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">4</td><td style = "text-align: right;">72081.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">5</td><td style = "text-align: right;">675232.0</td></tr></tbody></table></div><p>Using DataFramesMeta the DataFrame can be grouped based on the sample ID and amino acid fragment and each group corrected using the main function of this package: <code>isotope_correction()</code></p><p>Since this function outputs the corrected response, MID, mean enrichment and residuum, we index into element 1 to recieve only the corrected response. Additionally we are assuming that the tracer used for this experiment had a 99% purity.</p><pre><code class="language-julia hljs">gdfs = groupby(df, [:Sample, :AminoAcidFragment])
df_corrected = @transform(gdfs,
    :CorrectedResponse = isotope_correction(Vector(:Response), :Molecule[1]; tracer_purity = 0.99)[1])</code></pre><div><div style = "float: left;"><span>22×7 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Sample</th><th style = "text-align: left;">AminoAcidFragment</th><th style = "text-align: left;">Molecule</th><th style = "text-align: left;">MZ0</th><th style = "text-align: left;">Mplus</th><th style = "text-align: left;">Response</th><th style = "text-align: left;">CorrectedResponse</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "String" style = "text-align: left;">String</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">0</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.56351e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">1</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.09316e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">2</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.13614e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">3</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.13323e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">4</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.15544e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">0</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">2.40728e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">1</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.76404e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">2</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.68186e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">3</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.73128e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">4</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.73267e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">5</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.74722e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">0</td><td style = "text-align: right;">141984.0</td><td style = "text-align: right;">1.78311e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">1</td><td style = "text-align: right;">4859.0</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">2</td><td style = "text-align: right;">418641.0</td><td style = "text-align: right;">5.16909e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">3</td><td style = "text-align: right;">811925.0</td><td style = "text-align: right;">9.31516e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: left;">C10H24N1S1Si1LabC4</td><td style = "text-align: right;">218</td><td style = "text-align: right;">4</td><td style = "text-align: right;">575490.0</td><td style = "text-align: right;">5.77142e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">0</td><td style = "text-align: right;">184399.0</td><td style = "text-align: right;">2.62424e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">1</td><td style = "text-align: right;">453077.0</td><td style = "text-align: right;">5.789e5</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">2</td><td style = "text-align: right;">478667.0</td><td style = "text-align: right;">512238.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">3</td><td style = "text-align: right;">161608.0</td><td style = "text-align: right;">47893.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">4</td><td style = "text-align: right;">72081.0</td><td style = "text-align: right;">25007.2</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: left;">C13H30N1O2S1Si2LabC5</td><td style = "text-align: right;">320</td><td style = "text-align: right;">5</td><td style = "text-align: right;">675232.0</td><td style = "text-align: right;">9.13788e5</td></tr></tbody></table></div><p>Now, again using DataFramesMeta, both the corrected and uncorrected MIDs can be calculated.</p><pre><code class="language-julia hljs">gdfs_corrected = groupby(df_corrected, [:Sample, :AminoAcidFragment])
df_corrected_MIDs = @transform(gdfs_corrected,
    :MID = :Response ./ sum(:Response),
    :CorrectedMID = :CorrectedResponse ./ sum(:CorrectedResponse))
select(df_corrected_MIDs, :Sample, :AminoAcidFragment, :Response, :CorrectedResponse, :MID, :CorrectedMID)
# And of course the finished DataFrame can then be saved.
# CSV.write(&quot;Corrected_MIDs.csv&quot;, df_corrected_MIDs)</code></pre><div><div style = "float: left;"><span>22×6 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "header"><th class = "rowNumber" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Sample</th><th style = "text-align: left;">AminoAcidFragment</th><th style = "text-align: left;">Response</th><th style = "text-align: left;">CorrectedResponse</th><th style = "text-align: left;">MID</th><th style = "text-align: left;">CorrectedMID</th></tr><tr class = "subheader headerLastRow"><th class = "rowNumber" style = "font-weight: bold; text-align: right;"></th><th title = "Int64" style = "text-align: left;">Int64</th><th title = "String" style = "text-align: left;">String</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th><th title = "Float64" style = "text-align: left;">Float64</th></tr></thead><tbody><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.56351e5</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.231332</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.09316e5</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.188888</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.13614e5</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.192767</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.13323e5</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.192504</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">200000.0</td><td style = "text-align: right;">2.15544e5</td><td style = "text-align: right;">0.2</td><td style = "text-align: right;">0.194508</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">2.40728e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.217571</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.76404e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.159434</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.68186e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.152007</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.73128e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.156474</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.73267e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.156599</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: right;">1</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">1.66667e5</td><td style = "text-align: right;">1.74722e5</td><td style = "text-align: right;">0.166667</td><td style = "text-align: right;">0.157914</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">141984.0</td><td style = "text-align: right;">1.78311e5</td><td style = "text-align: right;">0.0727042</td><td style = "text-align: right;">0.0809079</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">4859.0</td><td style = "text-align: right;">0.0</td><td style = "text-align: right;">0.0024881</td><td style = "text-align: right;">0.0</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">418641.0</td><td style = "text-align: right;">5.16909e5</td><td style = "text-align: right;">0.214369</td><td style = "text-align: right;">0.234545</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">811925.0</td><td style = "text-align: right;">9.31516e5</td><td style = "text-align: right;">0.415754</td><td style = "text-align: right;">0.422671</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-159)</td><td style = "text-align: right;">575490.0</td><td style = "text-align: right;">5.77142e5</td><td style = "text-align: right;">0.294685</td><td style = "text-align: right;">0.261876</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">184399.0</td><td style = "text-align: right;">2.62424e5</td><td style = "text-align: right;">0.0910584</td><td style = "text-align: right;">0.112135</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">453077.0</td><td style = "text-align: right;">5.789e5</td><td style = "text-align: right;">0.223735</td><td style = "text-align: right;">0.247367</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">478667.0</td><td style = "text-align: right;">512238.0</td><td style = "text-align: right;">0.236371</td><td style = "text-align: right;">0.218882</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">161608.0</td><td style = "text-align: right;">47893.0</td><td style = "text-align: right;">0.0798039</td><td style = "text-align: right;">0.0204649</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">72081.0</td><td style = "text-align: right;">25007.2</td><td style = "text-align: right;">0.0355944</td><td style = "text-align: right;">0.0106857</td></tr><tr><td class = "rowNumber" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: right;">2</td><td style = "text-align: left;">Met_(M-57)</td><td style = "text-align: right;">675232.0</td><td style = "text-align: right;">9.13788e5</td><td style = "text-align: right;">0.333437</td><td style = "text-align: right;">0.390466</td></tr></tbody></table></div><p>To visualize what <code>isotope_correction()</code> does we can plot the MIDs before and after correction.</p><pre><code class="language-julia hljs">using ColorSchemes, CairoMakie

gdfs = @groupby(df_corrected_MIDs, :Sample, :AminoAcidFragment)

colors = colorschemes[:bamako][1:43:256];
group_color = [PolyElement(color = color, strokecolor = :transparent)
    for color in colors]
labels = [&quot;m+0&quot;, &quot;m+1&quot;, &quot;m+2&quot;, &quot;m+3&quot;, &quot;m+4&quot;, &quot;m+5&quot;]

fig = Figure();

function myplot(group, fig, colors)
    name = group.AminoAcidFragment[1]
    sample = group.Sample[1]
    ax = Axis(fig,
        xticks = (1:2, [&quot;uncorrected&quot;, &quot;corrected&quot;]),
        title = &quot;Sample $sample $name MID&quot;)
    barplot!(ax, repeat([1, 2], inner = length(group.MID)),
        cat(group.MID, group.CorrectedMID, dims = 1),
        stack = repeat(group.Mplus, 2),
        colormap = colors,
        color = repeat(group.Mplus .+ 1, 2))
end
myplot(gdfs[1], fig[1,1], colors[1:5])
myplot(gdfs[2], fig[1,2], colors)
myplot(gdfs[3], fig[2,1], colors[1:5])
myplot(gdfs[4], fig[2,2], colors)

Legend(fig[1:2,3], group_color, labels, framevisible = false)

fig
# save(&quot;Methionine_MIDs.png&quot;, fig)</code></pre><img src="2ea7b269.png" alt="Example block output"/><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Reference</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 19 September 2024 00:29">Thursday 19 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
