var documenterSearchIndex = {"docs":
[{"location":"examples/","page":"Examples","title":"Examples","text":"EditURL = \"examples.jl\"","category":"page"},{"location":"examples/#Examples","page":"Examples","title":"Examples","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"using NaturalIsotopeCorrection","category":"page"},{"location":"examples/#Example-1","page":"Examples","title":"Example 1","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"In the first example we will correct a measured response vector of the M-57 alanine fragment. First the chemical formula of the fragment and the response vector have to be defined, after which the uncorrected mass isotopomer distribution (MID) can be calculated. the number behind Note: The number after \"LabC\" in the chemical formula represents the number of possibly labeled carbon atoms in the fragment while the number behind \"C\" is the total number of carbon atoms, both from the alanine and from any derivative groups.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"ala_m57 = \"C11H26N1O2Si2LabC3\"\nresponse_vec = [2500000, 2000000, 2500000, 800000]\nMID = response_vec ./ sum(response_vec)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"The function isotope_correction() can be directly used on a single measurement vector. Here we are assuming that the tracer used for this experiment had an 80% purity.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"corr_response, corr_MID, mean_enrichment, residuum = isotope_correction(response_vec, ala_m57; tracer_purity = 0.8)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"using Test @test corrresponse ≈ [3.7494356377578774e6, 1.582246275076472e6, 3.110758584864337e6, 392021.5450371306] @test corrMID ≈ [0.42441018135800024, 0.17909933478943207, 0.3521163563572243, 0.04437412749534335] @test mean_enrichment ≈ 0.5041136074974777 @test isapprox(residuum, [7.161631798132872e-13, 8.285188904175392e-13, -1.0657673462843284e-12, 6.363440591555375e-13]; atol = 1e16)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"The optimization can also be turned off, though this isn't recommended as the optimization prevents negative values in the corrected response.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"corr_response, corr_MID, mean_enrichment = isotope_correction(response_vec, ala_m57; tracer_purity = 0.8, optimization = false)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"@test corrresponse ≈ [2.788815753935856e6, 1.7402842780064365e6, 2.8703208164970432e6, 961526.0409580052] @test corrMID ≈ [0.333552621590313, 0.20814440051201863, 0.3433009268527882, 0.11500205104488019] @test mean_enrichment ≈ 0.5599381018380588","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"To visualize the effects of isotope_correction(), the MID can be plotted before and after correction.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"using ColorSchemes, CairoMakie\n\ncolors = colorschemes[:bamako][1:64:end];\ngroup_color = [PolyElement(color = color, strokecolor = :transparent)\n    for color in colors]\nlabels = [\"m+0\", \"m+1\", \"m+2\", \"m+3\"]\nMplus = [0, 1, 2, 3]\n\nfig = Figure();\nax = Axis(fig[1,1],\n    xticks = (1:2, [\"uncorrected\", \"corrected\"]),\n    title = \"Alanine (M-57) MID\")\nbarplot!(ax, repeat([1, 2], inner = length(corr_MID)),\n    cat(MID, corr_MID, dims = 1),\n    stack = repeat(Mplus, 2),\n    colormap = colors,\n    color = repeat(Mplus .+ 1, 2))\nLegend(fig[1,2], group_color, labels, framevisible = false)\nfig","category":"page"},{"location":"examples/#Example-2","page":"Examples","title":"Example 2","text":"","category":"section"},{"location":"examples/","page":"Examples","title":"Examples","text":"using DataFrames, DataFramesMeta","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"For this example we will make a very simple DataFrame with 2 samples for each of which 2 methionine fragments were measured, specifically M-159 and M-57. We need the chemical formulas of both fragments, as shown in the code below, as well as measured response vectors. For this example the measured response for sample 1 is all possible m+ being recorded with equal frequency while the measured response for sample 2 is simply a random vector. Note: The number after \"LabC\" in the chemical formula represents the number of possibly labeled carbon atoms in the fragment while the number behind \"C\" is the total number of carbon atoms, both from the methionine and from any derivative groups.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"df = DataFrame(\n    Sample = repeat([1, 2], inner = 11),\n    AminoAcidFragment = repeat(cat(repeat([\"Met_(M-159)\"], 5), repeat([\"Met_(M-57)\"], 6), dims = 1), 2),\n    Molecule = repeat(cat(repeat([\"C10H24N1S1Si1LabC4\"], 5), repeat([\"C13H30N1O2S1Si2LabC5\"], 6), dims = 1), 2),\n    MZ0 = repeat(cat(repeat([218], 5), repeat([320], 6), dims = 1), 2),\n    Mplus = repeat(cat(repeat(0:4, 1), repeat(0:5, 1), dims = 1), 2),\n    Response = cat(repeat([1e6/5], 5), repeat([1e6/6], 6), rand(0:1e6, 11), dims = 1)\n)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Of course normally the first step would be to read in (and prepare) real data, using CSV.jl or XLSX.jl, for example. df = CSV.read(\"DATA.csv\", DataFrame)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Using DataFramesMeta the DataFrame can be grouped based on the sample ID and amino acid fragment and each group corrected using the main function of this package: isotope_correction() Since this function outputs the corrected response, MID, mean enrichment and residuum, we index into element 1 to recieve only the corrected response. Additionally we are assuming that the tracer used for this experiment had a 99% purity.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"gdfs = groupby(df, [:Sample, :AminoAcidFragment])\ndf_corrected = @transform(gdfs,\n    :CorrectedResponse = isotope_correction(Vector(:Response), :Molecule[1]; tracer_purity = 0.99)[1]\n)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Now, again using DataFramesMeta, both the corrected and uncorrected MIDs can be calculated.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"gdfs_corrected = groupby(df_corrected, [:Sample, :AminoAcidFragment])\ndf_corrected_MIDs = @transform(gdfs_corrected,\n    :MID = :Response ./ sum(:Response),\n    :CorrectedMID = :CorrectedResponse ./ sum(:CorrectedResponse)\n)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"@test dfcorrectedMIDs.CorrectedResponse[1:11] ≈ [256350.5953947725, 209316.21271342717,     213614.23098928804, 213323.38585836615, 215543.78052654164,     240727.618300901, 176403.71542171348, 168185.8260919769,     173128.23316293195, 173266.76220269877, 174721.82172768374 ] @test dfcorrectedMIDs.CorrectedMID[1:11] ≈ [0.2313324103459418, 0.18888828378538802,     0.19276684285771886, 0.19250438235876846, 0.19450808065218303,     0.21757070311023, 0.15943447065382058, 0.1520071053511907,     0.15647407507022204, 0.1565992782388322, 0.15791436757570465 ]","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"Finally, the finished DataFrame can be saved. using CSV CSV.write(\"CorrectedMIDs.csv\", dfcorrected_MIDs)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"To visualize what isotope_correction() does we can plot the MIDs before and after correction.","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"using ColorSchemes, CairoMakie\n\ngdfs = @groupby(df_corrected_MIDs, :Sample, :AminoAcidFragment)\n\ncolors = colorschemes[:bamako][1:43:256];\ngroup_color = [PolyElement(color = color, strokecolor = :transparent)\n    for color in colors]\nlabels = [\"m+0\", \"m+1\", \"m+2\", \"m+3\", \"m+4\", \"m+5\"]\n\nfig = Figure();\n\nfunction myplot(group, fig, colors)\n    name = group.AminoAcidFragment[1]\n    sample = group.Sample[1]\n    ax = Axis(fig,\n        xticks = (1:2, [\"uncorrected\", \"corrected\"]),\n        title = \"Sample $sample $name MID\")\n    barplot!(ax, repeat([1, 2], inner = length(group.MID)),\n        cat(group.MID, group.CorrectedMID, dims = 1),\n        stack = repeat(group.Mplus, 2),\n        colormap = colors,\n        color = repeat(group.Mplus .+ 1, 2))\nend\nmyplot(gdfs[1], fig[1,1], colors[1:5])\nmyplot(gdfs[2], fig[1,2], colors)\nmyplot(gdfs[3], fig[2,1], colors[1:5])\nmyplot(gdfs[4], fig[2,2], colors)\n\nLegend(fig[1:2,3], group_color, labels, framevisible = false)\n\nfig","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"save(\"Methionine_MIDs.png\", fig)","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"","category":"page"},{"location":"examples/","page":"Examples","title":"Examples","text":"This page was generated using Literate.jl.","category":"page"},{"location":"background/","page":"Background","title":"Background","text":"CurrentModule = NaturalIsotopeCorrection","category":"page"},{"location":"background/#Background","page":"Background","title":"Background","text":"","category":"section"},{"location":"background/","page":"Background","title":"Background","text":"Documentation for NaturalIsotopeCorrection.","category":"page"},{"location":"background/","page":"Background","title":"Background","text":"Metabolic flux analysis (MFA) is a powerful method used to assess intracellular metabolic activity by estimating \nthe fluxes of different metabolic pathways. This approach is often more informative than simply measuring \nmetabolite concentrations as it helps to understand how cells respond to different conditions. \nThe stable isotope of carbon, carbon-13 (13C), is commonly used as a tracer in MFA to investigate metabolic \nfluxes, though other isotopes like nitrogen-15 (15N) can be used. These isotopes do not significantly alter \nthe chemical properties of the molecules they label, making them ideal for tracking metabolic processes. \nHowever, naturally occurring isotopes can affect the accuracy of the isotope tracing, \nas their presence interferes with the signals obtained from the isotopically labeled substrates.\n\nWhen conducting isotope labeling experiments, it is critical to distinguish between isotopes introduced into \nthe system experimentally and those naturally present at the start of the experiment. The natural abundance (NA) \nof stable isotopes can falsify the results of isotope labeling studies if not corrected appropriately{1}. \nFor example, carbon naturally exists as  approximately 98.93% 12C and 1.07% 13C. Ignoring the NA of 13C \ncould lead to errors in the interpretation of metabolic fluxes, especially when using gas chromatography \nmass spectrometry (GCMS) as the derivatization necessary for gas chromatography leads to more incorporated atoms.\n\nWhile early correction methods were based on the assumption that mass isotopomer distributions (MIDs) \nof labeled standards were simply shifted versions of the unlabeled standards, it is much more accurate \nto account for the non-linear distribution of stable isotopes, or \"skew,\" caused by isotopic enrichment from \nexperimental tracers. \nThis package implements this “skewed” correction method, using multinomial probability theory to account \nfor the non-linear distribution of naturally occurring isotopes. A least-squares optimization function ensures \nthat fractional abundances remain positive after correction is used and corrects for noise, \nsimilarly to IsoCor{2}. In addition to correcting for the natural abundances of all isotopes, correction for \nthe purity of the tracer substrate is also implemented.\n\n{1}\tMidani, F. S.; Wynn, M. L.; Schnell, S. The Importance of Accurately Correcting for the Natural Abundance \nof Stable Isotopes. Anal. Biochem. 2017, 520, 27–43. https://doi.org/10.1016/j.ab.2016.12.011.\n{2}\tMillard, P.; Letisse, F.; Sokol, S.; Portais, J.-C. IsoCor: Correcting MS Data in Isotope Labeling \nExperiments. Bioinformatics 2012, 28 (9), 1294–1296. https://doi.org/10.1093/bioinformatics/bts127.\n","category":"page"},{"location":"","page":"Reference","title":"Reference","text":"CurrentModule = NaturalIsotopeCorrection","category":"page"},{"location":"#NaturalIsotopeCorrection","page":"Reference","title":"NaturalIsotopeCorrection","text":"","category":"section"},{"location":"","page":"Reference","title":"Reference","text":"Documentation for NaturalIsotopeCorrection.","category":"page"},{"location":"","page":"Reference","title":"Reference","text":"","category":"page"},{"location":"","page":"Reference","title":"Reference","text":"Modules = [NaturalIsotopeCorrection]","category":"page"},{"location":"#NaturalIsotopeCorrection._standard_element_MID-Tuple{Dict, Any, Int64}","page":"Reference","title":"NaturalIsotopeCorrection._standard_element_MID","text":"_standard_element_MID(isotopes, element, N)\n\nOutputs the classic standard mass isotopomer distribution (MID) for a fragment      with N atoms of the given element, using combinatorial probabilities. Not to be used for atoms labeled through an isotope tracer experiment, e.g.      backbone carbon atoms in a 13C tracer experiment.\n\nArguments\n\nisotopes::Dict: dictionary containing the natural abundances of the relevant isotopes.\nelement: the element the standard MID should be computed for.\nN::Int: the number atoms of the given element.\n\n\n\n\n\n","category":"method"},{"location":"#NaturalIsotopeCorrection.element_CM-Tuple{Any, Int64}","page":"Reference","title":"NaturalIsotopeCorrection.element_CM","text":"element_CM(element, N)\n\nOutputs the correction matrix for a fragment with N atoms of the given element. All correction matricies will be l+1 x l+1 with l being the total number of possibly labeled atoms.\n\nArguments\n\nelement: the element the standard MID should be computed for.\nN::Int: the number atoms of the given element.\nl::Int: total number of possibly labeled atoms, default is -1, only needed for unlabeled atoms.\ntracer_purity: purity of the tracer, default is 1 (100%).\n\n\n\n\n\n","category":"method"},{"location":"#NaturalIsotopeCorrection.fragment_CM-Tuple{Any}","page":"Reference","title":"NaturalIsotopeCorrection.fragment_CM","text":"fragment_CM(formula)\n\nOutputs the full correction matrix for a fragment. The correction matricies will be l+1 x l+1 with l being the total number of possibly labeled atoms.\n\nArguments\n\nformula: chemical formula of the fragment to be corrected.\ntracer_purity: purity of the tracer, default is 1 (100%).\n\n\n\n\n\n","category":"method"},{"location":"#NaturalIsotopeCorrection.isotope_correction-Tuple{Any, Any}","page":"Reference","title":"NaturalIsotopeCorrection.isotope_correction","text":"isotope_correction(response, formula)\n\nOutputs the corrected LC-/GCMS response, mass isotopomer distribution (MID) and mean enrichment of a fragment. Additionally outputs the residuum when using L-BFGS-B for optimization.\n\nArguments\n\nresponse::Vector: the response / measurement vector obtained from LC-/GCMS, must have    the length l+1 if l is equal to the amount of possibly labeled atoms in the fragment\nformula::String: chemical formula of the fragment to be corrected.\ntracer_purity = 1.0: purity of the tracer, the default represents 100%.\noptimization::Bool = true: whether to use the L-BFGS-B optimization algorithm.\n\nExamples\n\njulia> pyruvate = \"C3H3O3LabC3\"\njulia> response_vec = [3500000, 1000000, 3500000, 800000]\njulia> corr_response, MID, mean_enrichment, residuum = isotope_correction(response, pyruvate; tracer_purity = 0.99)\n([3.6690841286892043e6, 880069.4781954776, 3.548554810172248e6, 765218.8519553166], \n[0.41398107163956405, 0.09929783371601102, 0.4003818041674765, 0.08633929047694855], \n0.5397698283704524, \n[-1.0858374563130465e-13, -2.566428685730154e-15, 1.1059455573558807e-13, -1.6554787924343889e-13])\njulia> corr_response, MID, mean_enrichment = isotope_correction(response, pyruvate; tracer_purity = 0.99, optimization = false)\n([3.6690841286882004e6, 880069.4781954774, 3.548554810173271e6, 765218.8519538215], \n[0.41398107163951964, 0.09929783371602752, 0.40038180416765856, 0.08633929047679423], \n0.5397698283704317)\n\n\n\n\n\n\n","category":"method"}]
}
